{
      name: 'W3050',
      description: "WOMEN'S AGE BETWEEN 30 TO 50.",
      gender: 'm',
      min_age: 5,
      max_age: 99,
      country: 'US',
      attributes: {
        race: "3"
      },
    }

 

 

GET:

 

    audiences: [ {
      name: 'W3050',
      description: "WOMEN'S AGE BETWEEN 30 TO 50.",
      gender: {"label": "Female", "value":"w"},
      min_age: 5,
      max_age: 99,
      country: 'US',
      attributes: [
        { "attribute_name": "race",

           "attribute_label": "Race",

           "attribute_value": { value: 3, label: 'Black' },
      ]
    }, {
      name: 'M1865',
      description: "MEN AGE BETWEEN 18 TO 65.",
      gender: {"label": "Male", "value":"m"},
      min_age: 18,
      max_age: 65,
      country: 'US',
      attributes: [
        { "attribute_name": "race",

           "attribute_label": "Race",

           "attribute_value": { value: 3, label: 'Black' },
      ]
    },

];


gcloud spanner databases ddl update test-database --instance=test2-instance --ddl "CREATE TABLE attributes_names (country_code STRING(36), attribute_name STRING(250)) PRIMARY KEY (country_code,attribute_name)"


gcloud spanner databases ddl update test-database --instance=test2-instance --ddl "CREATE TABLE attributes_label (country_code STRING(36), attribute_name STRING(250),label STRING(306),description STRING(250),CreatedAt TIMESTAMP,UpdatedAt TIMESTAMP) PRIMARY KEY (country_code,attribute_name)"



gcloud spanner databases ddl update test-database --instance=test2-instance --ddl "CREATE TABLE attributes_value (country_code STRING(36),attribute_name STRING(400), attribute_value STRING(250)) PRIMARY KEY (country_code,attribute_name,attribute_value)"

gcloud spanner databases ddl update test-database --instance=test2-instance --ddl "CREATE TABLE attributes_value_label (country_code STRING(36),attribute_name STRING(400), attribute_value STRING(250),label STRING(306),description STRING(250)) PRIMARY KEY (country_code,attribute_name,attribute_value)"


gcloud spanner databases ddl update test-database --instance=test2-instance --ddl "CREATE TABLE audience (name STRING(36),description STRING(400), Gender STRING(250), Agerange ARRAY<INT64>) PRIMARY KEY (name,description)"


gcloud spanner databases ddl update test-database --instance=test2-instance --ddl "CREATE TABLE audience_create (name STRING(50),description STRING(100), gender STRING(6), minimum_age INT64,maximum_age INT64,country STRING(2),attributes JSON) PRIMARY KEY (name)"



 query = f"""
        SELECT
            a.name,
            a.description,
            a.gender,
            a.minimum_age,
            a.maximum_age,
            a.country,
            ARRAY<STRUCT<attribute_name STRING, attribute_label STRING, attribute_value STRUCT<value INT64, label STRING>>>(
                STRUCT<attribute_name, attribute_label, attribute_value>(
                    an.attribute_name,
                    al.label,
                    STRUCT<value, label>(
                        av.value,
                        avl.label
                    )
                )
            ) as attributes
        FROM
            audience_create a
        LEFT JOIN
            attributes_names an
        ON
            a.name = an.name
        LEFT JOIN
            attributes_label al
        ON
            a.name = al.name AND an.attribute_name = al.attribute_name
        LEFT JOIN
            attributes_value av
        ON
            a.name = av.name AND an.attribute_name = av.attribute_name
        LEFT JOIN
            attributes_value_label avl
        ON
            a.name = avl.name AND an.attribute_name = avl.attribute_name AND av.attribute_value = avl.attribute_value
        WHERE
            a.name = @audience_name
    """
